I"<p>我找了很久没有发现 SolutionDir 这个定义，所以只能通过一个不通用的方法找到</p>

<!--more-->

<!-- CreateTime:2019/7/22 8:57:14 -->

<!-- csdn -->

<!-- 标签：Roslyn,MSBuild,编译器 -->

<p>在之前的项目可以使用 PreBuildEvent 的方式指定编译之前事件，新的项目格式也可以支持这个方法，只是支持不是很好</p>

<p>我就遇到在 Jenkins 无法编译通过，因为 PreBuildEvent 指定的 <code class="language-plaintext highlighter-rouge">$(SolutionDir)</code> 是空</p>

<p>在新的项目格式，找了很久都没有找到 <code class="language-plaintext highlighter-rouge">$(SolutionDir)</code> 的定义和找到运行的 sln 文件的定义的方法</p>

<p>于是通过 <a href="https://lindexi.oschina.io/lindexi/post/Roslyn-%E4%BD%BF%E7%94%A8-Directory.Build.props-%E6%96%87%E4%BB%B6%E5%AE%9A%E4%B9%89%E7%BC%96%E8%AF%91.html">Directory.Build.props</a> 的方法找到 sln 文件</p>

<!-- ![](image/Roslyn 获得 sln 文件所在的文件夹/Roslyn 获得 sln 文件所在的文件夹0.png) -->

<p>在 sln 文件所在的文件夹添加 Directory.Build.props 文件，因为很多项目的 sln 都在项目的最外，所以通过这个方法找到 sln 是可以的，只是不通用</p>

<p>如我有一个项目 lindexi 这个项目的文件夹请看下图</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">|</span>   <span class="n">Directory</span><span class="p">.</span><span class="n">Build</span><span class="p">.</span><span class="n">props</span>
<span class="p">|</span>   <span class="n">lindexi</span><span class="p">.</span><span class="n">sln</span>
<span class="p">|</span>   <span class="n">README</span><span class="p">.</span><span class="n">md</span>
<span class="p">|</span>
<span class="err">\</span><span class="p">---</span><span class="n">src</span>
        <span class="n">lindexi</span><span class="p">.</span><span class="n">csproj</span>
</code></pre></div></div>

<p>在 Directory.Build.props 添加下面代码</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="n">Project</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="n">PropertyGroup</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="n">SolutionDir</span><span class="p">&gt;</span><span class="err">$</span><span class="p">(</span><span class="n">MSBuildThisFileDirectory</span><span class="p">)&lt;/</span><span class="n">SolutionDir</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="n">PropertyGroup</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="n">Project</span><span class="p">&gt;</span>

</code></pre></div></div>

<p>因为 <code class="language-plaintext highlighter-rouge">$(MSBuildThisFileDirectory)</code> 就是当前的文件的文件夹，这个文件和 sln 文件刚好在相同的文件夹，所以通过这个方法就可以获得 sln 所在的文件夹</p>

<p><a href="https://blog.walterlv.com/post/known-properties-in-csproj.html">项目文件中的已知属性（知道了这些，就不会随便在 csproj 中写死常量啦） - walterlv</a></p>

<p><a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild-well-known-item-metadata?view=vs-2017">MSBuild Well-known Item Metadata</a></p>

<p><a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild-reserved-and-well-known-properties?view=vs-2017">MSBuild Reserved and Well-known Properties</a></p>

<p>更多请看 <a href="https://lindexi.oschina.io/lindexi/post/roslyn.html">手把手教你写 Roslyn 修改编译</a></p>

<p><img src="http://image.acmx.xyz/lindexi%2F2019123205745682" alt="" /></p>

:ET